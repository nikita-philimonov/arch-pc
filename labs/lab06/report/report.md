---
## Front matter
title: "Отчёт по лабораторной работе 6"
subtitle: "Архитектура компьютеров"
author: "Филимонов Никита Сергеевич НБИбд-03-24"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: PT Serif
romanfont: PT Serif
sansfont: PT Sans
monofont: PT Mono
mainfontoptions: Ligatures=TeX
romanfontoptions: Ligatures=TeX
sansfontoptions: Ligatures=TeX,Scale=MatchLowercase
monofontoptions: Scale=MatchLowercase,Scale=0.9
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Целью работы является освоение арифметических инструкций языка ассемблера NASM.

# Выполнение лабораторной работы

## Символьные и численные данные в NASM

Создаю каталог для программ лабораторной работы № 6, перехожу в него и создаю файл `lab6-1.asm`.

Рассмотрим примеры программ вывода символьных и численных значений. Программы будут выводить значения, записанные в регистр `eax`.

В данной программе в регистр `eax` записывается символ `6` (используя команду `mov eax, '6'`), в регистр `ebx` записывается символ `4` (используя команду `mov ebx, '4'`). Далее к значению в регистре `eax` прибавляем значение регистра `ebx` (командой `add eax, ebx`, результат сложения запишется в регистр `eax`). После этого выводим результат. (изображение 1) (изображение 2)

Так как для работы функции `sprintLF` в регистр `eax` должен быть записан адрес, необходимо использовать дополнительную переменную. Для этого запишем значение регистра `eax` в переменную `buf1` (командой `mov [buf1], eax`), а затем запишем адрес переменной `buf1` в регистр `eax` (командой `mov eax, buf1`) и вызовем функцию `sprintLF`.

![Программа lab6-1.asm](image/01.png){ #fig:001 width=70%, height=70% }

![Запуск программы lab6-1.asm](image/02.png){ #fig:002 width=70%, height=70% }

В данном случае при выводе значения регистра `eax` мы ожидаем увидеть число `10`. Однако результатом будет символ `j`. Это происходит потому, что код символа `6` равен `00110110` в двоичном представлении (или `54` в десятичном представлении), а код символа `4` – `00110100` (52). Команда `add eax, ebx` запишет в регистр `eax` сумму кодов – `01101010` (106), что в свою очередь является кодом символа `j`.

Далее изменяю текст программы и вместо символов запишем в регистры числа. (изображение 3) (изображение 4)

![Программа lab6-1.asm с числами](image/03.png){ #fig:003 width=70%, height=70% }

![Запуск программы lab6-1.asm с числами](image/04.png){ #fig:004 width=70%, height=70% }

Как и в предыдущем случае при исполнении программы мы не получим число `10`. В данном случае выводится символ с кодом `10`. Это символ конца строки (возврат каретки). В консоли он не отображается, но добавляет пустую строку.

Как отмечалось выше, для работы с числами в файле `in_out.asm` реализованы подпрограммы для преобразования ASCII символов в числа и обратно. Преобразую текст программы с использованием этих функций. (изображение 5) (изображение 6)

![Программа lab6-2.asm](image/05.png){ #fig:005 width=70%, height=70% }

![Запуск программы lab6-2.asm](image/06.png){ #fig:006 width=70%, height=70% }

В результате работы программы мы получим число `106`. В данном случае, как и в первом, команда `add` складывает коды символов `‘6’` и `‘4’` (54+52=106). Однако, в отличие от прошлой программы, функция `iprintLF` позволяет вывести число, а не символ, кодом которого является это число.

Аналогично предыдущему примеру изменим символы на числа. (изображение 7) (изображение 8)

![Программа lab6-2.asm с числами](image/07.png){ #fig:007 width=70%, height=70% }

Функция `iprintLF` позволяет вывести число, и операндами были числа (а не коды символов). Поэтому получаем число `10`.

![Запуск программы lab6-2.asm с числами](image/08.png){ #fig:008 width=70%, height=70% }

Заменил функцию `iprintLF` на `iprint`. Создал исполняемый файл и запустил его. Вывод отличается тем, что нет переноса строки. (изображение 9)

![Запуск программы lab6-2.asm без переноса строки](image/09.png){ #fig:009 width=70%, height=70% }

## Выполнение арифметических операций в NASM

В качестве примера выполнения арифметических операций в NASM приведем программу вычисления арифметического выражения $ f(x) = (5 * 2 + 3)/3 $. (изображение 10) (изображение 11)

![Программа lab6-3.asm](image/10.png){ #fig:010 width=70%, height=70% }

![Запуск программы lab6-3.asm](image/11.png){ #fig:011 width=70%, height=70% }

Изменил текст программы для вычисления выражения $ f(x) = (4 * 6 + 2)/5 $. Создал исполняемый файл и проверил его работу. (изображение 12) (изображение 13)

![Программа lab6-3.asm с другим выражением](image/12.png){ #fig:012 width=70%, height=70% }

![Запуск программы lab6-3.asm с другим выражением](image/13.png){ #fig:013 width=70%, height=70% }

В качестве другого примера рассмотрим программу вычисления варианта задания по номеру студенческого билета. (изображение 14) (изображение 15)

В данном случае число, над которым необходимо проводить арифметические операции, вводится с клавиатуры. Как отмечалось выше, ввод с клавиатуры осуществляется в символьном виде, и для корректной работы арифметических операций в NASM символы необходимо преобразовать в числа. Для этого может быть использована функция `atoi` из файла `in_out.asm`.

![Программа variant.asm](image/14.png){ #fig:014 width=70%, height=70% }

![Запуск программы variant.asm](image/15.png){ #fig:015 width=70%, height=70% }

## Ответы на вопросы

1. Какие строки листинга отвечают за вывод на экран сообщения ‘Ваш вариант:’?
   - Инструкция `mov eax, rem` перекладывает значение переменной с фразой ‘Ваш вариант:’ в регистр `eax`.
   - Инструкция `call sprint` вызывает подпрограмму для вывода строки.

2. Для чего используются следующие инструкции?
   - Инструкция `mov ecx, x` используется для перемещения значения переменной `x` в регистр `ecx`.
   - Инструкция `mov edx, 80` используется для перемещения значения `80` в регистр `edx`.
   - Инструкция `call sread` вызывает подпрограмму для считывания значения студенческого билета из консоли.

3. Для чего используется инструкция “call atoi”?
   - Инструкция “call atoi” используется для преобразования введенных символов в числовой формат.

4. Какие строки листинга отвечают за вычисления варианта?
   - Инструкция `xor edx, edx` обнуляет регистр `edx`.
   - Инструкция `mov ebx, 20` записывает значение `20` в регистр `ebx`.
   - Инструкция `div ebx` выполняет деление номера студенческого билета на `20`.
   - Инструкция `inc edx` увеличивает значение регистра `edx` на `1`.

   Здесь происходит деление номера студенческого билета на `20`. В регистре `edx` хранится остаток, к нему прибавляется `1`.

5. В какой регистр записывается остаток от деления при выполнении инструкции “div ebx”?
   - Остаток от деления записывается в регистр `edx`.

6. Для чего используется инструкция “inc edx”?
   - Инструкция “inc edx” используется для увеличения значения в регистре `edx` на `1`, согласно формуле вычисления варианта.

7. Какие строки листинга отвечают за вывод на экран результата вычислений? 
   - Инструкция `mov eax, edx` перекладывает результат вычислений в регистр `eax`.
   - Инструкция `call iprintLF` вызывает подпрограмму для вывода значения на экран.

## Задание для самостоятельной работы

Написать программу вычисления выражения $ y = f(x) $. Программа должна выводить выражение для вычисления, выводить запрос на ввод значения `x`, вычислять заданное выражение в зависимости от введенного `x`, выводить результат вычислений. Вид функции $ f(x) $ выбрать из таблицы 6.3 вариантов заданий в соответствии с номером, полученным при выполнении лабораторной работы. Создайте исполняемый файл и проверьте его работу для значений `x1` и `x2` из 6.3. (изображение 16) (изображение 17)

Получили вариант `12` - $ (8x - 6)/2 $  для $ x=1, x=5 $

![Программа calc.asm](image/16.png){ #fig:016 width=70%, height=70% }

При $ x=1 $ получается `1`.

При $ x=5 $ получается `17`.

![Запуск программы calc.asm](image/17.png){ #fig:017 width=70%, height=70% }

Программа считает верно.


# Выводы

Изучили работу с арифметическими операциями.